#!/usr/bin/env python

import os

Import('envGlobal')

if envGlobal['OS'] == 'posix':
	# googletest should only be used when compiling for an hosted environment
	envGlobal.Append(CPPPATH=[
		os.path.abspath('gmock-1.6.0/fused-src'),
	    os.path.join( '../../pus/default'),
        os.path.join('../../spp/default'),
	])
	
	env = envGlobal.Clone()
	
	env['CXXFLAGS_language'] = ['-std=c++98']
	
	env.RemoveFromList('CCFLAGS_warning', [
		'-Wconversion',
		'-Wundef',
		'-Wmissing-declarations'])
	env.RemoveFromList('CXXFLAGS_warning', '-Wold-style-cast')
	
	files = env.Glob('gmock-1.6.0/fused-src/*.cc')
	objects = []
	for file in files:
		objects.append(env.Object(file))
	envGlobal.Append(objects={'gmock': objects})
	
	library = env.StaticLibrary('gmock-1.6.0', objects)
	
	envGlobal.Install('$BUILDPATH/lib', library)
	envGlobal.Append(LIBS=['gmock-1.6.0', 'pthread'])
	
